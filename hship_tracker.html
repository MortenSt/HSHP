<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>HSHP Fleet Manager</title>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #334155; }
        h3 { margin-top: 0; color: #38bdf8; display: flex; justify-content: space-between; }
        .data-display { background: #0f172a; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-size: 0.9em; min-height: 80px; }
        .data-item { margin-bottom: 5px; border-left: 3px solid #38bdf8; padding-left: 8px; }
        textarea { width: 100%; height: 60px; background: #334155; border: 1px solid #475569; color: white; border-radius: 4px; padding: 5px; font-size: 0.8em; resize: none; }
        button { background: #38bdf8; color: #0f172a; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        button:hover { background: #7dd3fc; }
        .label { font-size: 0.7em; color: #94a3b8; text-transform: uppercase; }
        .link-btn { font-size: 0.7em; color: #38bdf8; text-decoration: none; border: 1px solid #38bdf8; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>

    <h1>ðŸš¢ Himalaya Shipping Fleet Dashboard</h1>
    <p>Lim inn rÃ¥tekst fra MarineTraffic for Ã¥ oppdatere reisedata.</p>

    <div class="grid" id="fleet-grid"></div>

    <script>
        const shipList = [
            "Mount Norefjell", "Mount Ita", "Mount Etna", "Mount Blanc", 
            "Mount Matterhorn", "Mount Neblina", "Mount Bandeira", "Mount Hua", 
            "Mount Elbrus", "Mount Denali", "Mount Aconcagua", "Mount Emai"
        ];

        const grid = document.getElementById('fleet-grid');

        // Funksjon for Ã¥ rense og hente data fra tekst
        function parseShipData(rawText) {
            if (!rawText) return null;
            
            const data = {};
            // Enkel regex for Ã¥ finne mÃ¸nstre i kopiert tekst
            const depMatch = rawText.match(/Departure from\s*(.*?)(?=Arrival|$)/s);
            const arrMatch = rawText.match(/Arrival at\s*(.*?)(?=Actual|$)/s);
            const atdMatch = rawText.match(/Actual time of departure:\s*(.*?)(?=Reported|$)/s);
            const etaMatch = rawText.match(/Reported ETA:\s*(.*)/s);

            data.dep = depMatch ? depMatch[1].trim() : "Mangler data";
            data.arr = arrMatch ? arrMatch[1].trim() : "Mangler data";
            data.atd = atdMatch ? atdMatch[1].trim() : "Ikke satt";
            data.eta = etaMatch ? etaMatch[1].trim() : "Ikke satt";
            
            return data;
        }

        function saveAndRefresh(shipName) {
            const input = document.getElementById(`input-${shipName}`).value;
            if (input) {
                const parsed = parseShipData(input);
                localStorage.setItem(shipName, JSON.stringify(parsed));
                renderCards();
            }
        }

        function renderCards() {
            grid.innerHTML = '';
            shipList.forEach(ship => {
                const savedData = JSON.parse(localStorage.getItem(ship)) || { dep: "-", arr: "-", atd: "-", eta: "-" };
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${ship} <a href="https://www.marinetraffic.com/en/ais/details/ships/shipname:${ship.replace(' ', '_')}" target="_blank" class="link-btn">MT â†—</a></h3>
                    <div class="data-display">
                        <div class="data-item"><span class="label">Fra:</span> ${savedData.dep}</div>
                        <div class="data-item"><span class="label">Til:</span> ${savedData.arr}</div>
                        <div class="data-item"><span class="label">ATD:</span> ${savedData.atd}</div>
                        <div class="data-item"><span class="label">ETA:</span> ${savedData.eta}</div>
                    </div>
                    <textarea id="input-${ship}" placeholder="Lim inn tekst fra MarineTraffic her..."></textarea>
                    <button onclick="saveAndRefresh('${ship}')">Oppdater & Lagre</button>
                `;
                grid.appendChild(card);
            });
        }

        // Initial rendering
        renderCards();
    </script>

</body>
</html>
