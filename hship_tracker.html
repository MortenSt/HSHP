<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>HSHP Fleet Intelligence</title>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; padding: 20px; line-height: 1.6; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #38bdf8; border-bottom: 1px solid #334155; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .data-display { background: #0f172a; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85em; }
        .data-item { margin-bottom: 4px; display: flex; justify-content: space-between; }
        .label { color: #94a3b8; font-weight: bold; }
        textarea { width: 100%; background: #334155; border: 1px solid #475569; color: white; border-radius: 6px; padding: 8px; font-size: 0.8em; margin-bottom: 10px; }
        .x-notes { border-left: 3px solid #1da1f2; background: #1c2732; min-height: 40px; }
        button { background: #38bdf8; color: #0f172a; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        button:hover { background: #7dd3fc; }
        .mt-link { color: #38bdf8; text-decoration: none; font-size: 0.8em; border: 1px solid #38bdf8; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>ðŸš¢ Himalaya Shipping Intelligence Dashboard</h1>
    <p>Data lagres lokalt i din nettleser. Lim inn info fra MarineTraffic og notater fra X.</p>

    <div class="grid" id="fleet-grid"></div>

    <script>
        const shipData = [
            { name: "Mount Etna", id: "7628165" },
            { name: "Mount Ita", id: "7541333" },
            { name: "Mount Matterhorn", id: "7811695" },
            { name: "Mount Bandeira", id: "7549834" },
            { name: "Mount Norefjell", id: "7476053" },
            { name: "Mount Blanc", id: "7541334" },
            { name: "Mount Neblina", id: "7811696" },
            { name: "Mount Hua", id: "7811697" },
            { name: "Mount Elbrus", id: "7811698" },
            { name: "Mount Denali", id: "7811699" },
            { name: "Mount Aconcagua", id: "7811700" },
            { name: "Mount Emai", id: "7811701" }
        ];

        function parseMT(text) {
            if (!text) return null;
            const res = {};
            const dep = text.match(/Departure from\s*(.*?)(Arrival|Actual|$)/s);
            const arr = text.match(/Arrival at\s*(.*?)(Actual|Reported|$)/s);
            const eta = text.match(/Reported ETA:\s*(.*)/);
            res.dep = dep ? dep[1].trim() : "-";
            res.arr = arr ? arr[1].trim() : "-";
            res.eta = eta ? eta[1].trim() : "-";
            return res;
        }

        function save(name) {
            const raw = document.getElementById(`in-${name}`).value;
            const xVal = document.getElementById(`x-${name}`).value;
            const current = JSON.parse(localStorage.getItem(name)) || {};
            
            if (raw) {
                const parsed = parseMT(raw);
                current.voyage = parsed;
            }
            current.xNotes = xVal;
            
            localStorage.setItem(name, JSON.stringify(current));
            render();
        }

        function render() {
            const grid = document.getElementById('fleet-grid');
            grid.innerHTML = '';
            shipData.forEach(ship => {
                const saved = JSON.parse(localStorage.getItem(ship.name)) || { voyage: {dep:'-', arr:'-', eta:'-'}, xNotes: '' };
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${ship.name} <a href="https://www.marinetraffic.com/en/ais/details/ships/shipid:${ship.id}" target="_blank" class="mt-link">Ã…pne MT â†—</a></h3>
                    <div class="data-display">
                        <div class="data-item"><span class="label">Fra:</span> <span>${saved.voyage.dep}</span></div>
                        <div class="data-item"><span class="label">Til:</span> <span>${saved.voyage.arr}</span></div>
                        <div class="data-item"><span class="label">ETA:</span> <span>${saved.voyage.eta}</span></div>
                    </div>
                    <div class="label">Notater fra X:</div>
                    <textarea id="x-${ship.name}" class="x-notes" placeholder="Lim inn info fra X her...">${saved.xNotes}</textarea>
                    <div class="label">Oppdater reise (lim inn fra MT):</div>
                    <textarea id="in-${ship.name}" placeholder="Departure from... Arrival at..."></textarea>
                    <button onclick="save('${ship.name}')">Lagre status</button>
                `;
                grid.appendChild(card);
            });
        }
        render();
    </script>
</body>
</html>
